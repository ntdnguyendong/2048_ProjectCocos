{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/GameManagaer.js"],"names":["GAME_CONFIG","ROW","COL","MARGIN","ARR_BLOCK","DIRECTION","cc","Enum","RIGHT","LEFT","UP","DOWN","MIN_LENGTH","Class","extends","Component","properties","mainGame","Node","block","Prefab","score","Label","record","winGame","loseGame","hoverScorePrefab","_isChange","_restart","_score","_tempScore","onLoad","initObj","eventHandler","getScoreStorge","string","active","addNum","initBlock","removeAllChildren","y","height","x","width","row","col","newBlock","instantiate","setParent","setPosition","v2","label","getChildByName","getComponent","setColor","onKeyDown","event","_isCLick","keyCode","checkLeftRight","checkUpDown","systemEvent","on","SystemEvent","EventType","KEY_DOWN","sys","isMobile","_startPoint","getLocation","_endPoint","reflectTouch","IPAD","DESKTOP_BROWSER","_firstX","_firstY","_endX","_endY","_vector","reflectCLick","pointsVec","sub","vecLength","mag","Math","abs","touchEvent","mouseEvent","direction","slideLeftOrUp","array","newArray","push","length","slideRightOrDown","updateScore","newArr","randomXY","random","number","floor","hasChangeArray","arr1","arr2","checkLose","checkWin","temp","hoverScore","checkScore","num","parent","node","tween","to","position","call","destroy","start","clickRestart","value","arr","m","i","scoreStorge","localStorage","getItem","JSON","parse","newScore","parseInt","setItem","stringify","update"],"mappings":";;;;;;AACA,IAAMA,cAAc;AAChBC,SAAK,CADW;AAEhBC,SAAK,CAFW;AAGhBC,YAAQ,EAHQ,CAGL;AAHK,CAApB;;AAMA,IAAIC,YAAY,CACZ,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CADY,EACE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CADF,EAEZ,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAFY,EAEE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAFF,CAAhB;;AAKA,IAAMC,YAAYC,GAAGC,IAAH,CAAQ;AACtBC,WAAO,CAAC,CADc;AAEtBC,UAAM,CAAC,CAFe;AAGtBC,QAAI,CAAC,CAHiB;AAItBC,UAAM,CAAC;AAJe,CAAR,CAAlB;;AAOA,IAAMC,aAAa,EAAnB;;AAEAN,GAAGO,KAAH,CAAS;AACLC,aAASR,GAAGS,SADP;;AAGLC,gBAAY;AACRC,kBAAUX,GAAGY,IADL;AAERC,eAAOb,GAAGc,MAFF;AAGRC,eAAOf,GAAGgB,KAHF;AAIRC,gBAAQjB,GAAGgB,KAJH;AAKRE,iBAASlB,GAAGY,IALJ;AAMRO,kBAAUnB,GAAGY,IANL;AAORQ,0BAAkBpB,GAAGc,MAPb;;AASRO,mBAAW,KATH;AAURC,kBAAU,KAVF;AAWRC,gBAAQ,CAXA;AAYRC,oBAAa;AAZL,KAHP;;AAkBLC,UAlBK,oBAkBI;AACL;AACA,aAAKC,OAAL;AACA,aAAKC,YAAL;AACA,aAAKC,cAAL;AACA,aAAKb,KAAL,CAAWc,MAAX,GAAoB,CAApB;AACH,KAxBI;AA0BLH,WA1BK,qBA0BK;AACN,aAAKP,QAAL,CAAcW,MAAd,GAAuB,KAAvB;AACA,aAAKZ,OAAL,CAAaY,MAAb,GAAsB,KAAtB;AACA,aAAKC,MAAL;AACA,aAAKA,MAAL;AACH,KA/BI;AAiCLC,aAjCK,uBAiCO;AACR,aAAKrB,QAAL,CAAcsB,iBAAd;AACA,YAAIC,IAAI,KAAKvB,QAAL,CAAcwB,MAAd,GAAuB,CAAvB,GAA2BzC,YAAYG,MAA/C;AAAA,YACIuC,IAAI,KAAKzB,QAAL,CAAc0B,KAAd,GAAsB,CAAC,CAAvB,GAA2B3C,YAAYG,MAD/C;AAEA,aAAI,IAAIyC,MAAM,CAAd,EAAiBA,MAAM5C,YAAYC,GAAnC,EAAwC2C,KAAxC,EAA+C;AAC3C,iBAAI,IAAIC,MAAM,CAAd,EAAiBA,MAAM7C,YAAYE,GAAnC,EAAwC2C,KAAxC,EAA+C;AAC3C,qBAAKC,QAAL,GAAgBxC,GAAGyC,WAAH,CAAe,KAAK5B,KAApB,CAAhB;AACA,qBAAK2B,QAAL,CAAcE,SAAd,CAAwB,KAAK/B,QAA7B;AACA,qBAAK6B,QAAL,CAAcG,WAAd,CAA0B3C,GAAG4C,EAAH,CAAMR,CAAN,EAASF,CAAT,CAA1B;AACAE,qBAAK,KAAKI,QAAL,CAAcH,KAAd,GAAsB3C,YAAYG,MAAvC;AACA,oBAAGC,UAAUwC,GAAV,EAAeC,GAAf,KAAuB,CAA1B,EAA6B;AACzB,wBAAIM,QAAQ,KAAKL,QAAL,CAAcM,cAAd,CAA6B,OAA7B,CAAZ;AACAD,0BAAME,YAAN,CAAmB/C,GAAGgB,KAAtB,EAA6Ba,MAA7B,GAAsC/B,UAAUwC,GAAV,EAAeC,GAAf,CAAtC;AACA,yBAAKC,QAAL,CAAcO,YAAd,CAA2B,iBAA3B,EAA8CC,QAA9C;AACH;AACJ;AACDd,iBAAK,KAAKM,QAAL,CAAcL,MAAd,GAAuBzC,YAAYG,MAAxC;AACAuC,gBAAI,KAAKzB,QAAL,CAAc0B,KAAd,GAAsB,CAAC,CAAvB,GAA2B3C,YAAYG,MAA3C;AACH;AACJ,KApDI;AAsDLoD,aAtDK,qBAsDKC,KAtDL,EAsDY;AACb,YAAG,KAAKC,QAAR,EAAiB;AACb,iBAAK9B,SAAL,GAAiB,KAAjB;AACA,oBAAO6B,MAAME,OAAb;AACI,qBAAK,EAAL;AACA,qBAAK,EAAL;AACI,yBAAKC,cAAL,CAAoBH,MAAME,OAA1B;AACA;AACJ,qBAAK,EAAL;AACA,qBAAK,EAAL;AACI,yBAAKE,WAAL,CAAiBJ,MAAME,OAAvB;AAPR;AASH;AACJ,KAnEI;AAqELzB,gBArEK,0BAqEU;AAAA;;AACX3B,WAAGuD,WAAH,CAAeC,EAAf,CAAkBxD,GAAGyD,WAAH,CAAeC,SAAf,CAAyBC,QAA3C,EAAqD,KAAKV,SAA1D,EAAqE,IAArE;AACA,YAAIjD,GAAG4D,GAAH,CAAOC,QAAX,EAAqB;AACjB,iBAAKlD,QAAL,CAAc6C,EAAd,CAAiB,YAAjB,EAA+B,UAACN,KAAD,EAAW;AACtC,sBAAKY,WAAL,GAAmBZ,MAAMa,WAAN,EAAnB;AACH,aAFD;AAGA,iBAAKpD,QAAL,CAAc6C,EAAd,CAAiB,UAAjB,EAA6B,UAACN,KAAD,EAAW;AACpC,sBAAKc,SAAL,GAAiBd,MAAMa,WAAN,EAAjB;AACA,sBAAKE,YAAL;AACH,aAHD;AAIA,iBAAKtD,QAAL,CAAc6C,EAAd,CAAiB,aAAjB,EAAgC,UAACN,KAAD,EAAW;AACvC,sBAAKc,SAAL,GAAiBd,MAAMa,WAAN,EAAjB;AACA,sBAAKE,YAAL;AACH,aAHD;AAIH;AACD,YAAIjE,GAAG4D,GAAH,CAAOM,IAAP,IAAelE,GAAG4D,GAAH,CAAOO,eAA1B,EAA2C;AACvC,iBAAKxD,QAAL,CAAc6C,EAAd,CAAiB,WAAjB,EAA8B,UAACN,KAAD,EAAW;AACrC,sBAAKC,QAAL,GAAgB,KAAhB;AACA,sBAAKW,WAAL,GAAmBZ,MAAMa,WAAN,EAAnB;AACA,sBAAKK,OAAL,GAAe,MAAKN,WAAL,CAAiB1B,CAAhC;AACA,sBAAKiC,OAAL,GAAe,MAAKP,WAAL,CAAiB5B,CAAhC;AACH,aALD;AAMA,iBAAKvB,QAAL,CAAc6C,EAAd,CAAiB,SAAjB,EAA4B,UAACN,KAAD,EAAW;AACnC,sBAAKC,QAAL,GAAgB,IAAhB;AACA,sBAAKa,SAAL,GAAiBd,MAAMa,WAAN,EAAjB;AACA,sBAAKO,KAAL,GAAa,MAAKR,WAAL,CAAiB1B,CAAjB,GAAqB,MAAK4B,SAAL,CAAe5B,CAAjD;AACA,sBAAKmC,KAAL,GAAa,MAAKT,WAAL,CAAiB5B,CAAjB,GAAqB,MAAK8B,SAAL,CAAe9B,CAAjD;AACA,sBAAKsC,OAAL,GAAexE,GAAG4C,EAAH,CAAM,MAAK0B,KAAX,EAAkB,MAAKC,KAAvB,CAAf;AACA,sBAAKE,YAAL;AACH,aAPD;AAQH;AACJ,KApGI;AAsGLR,gBAtGK,0BAsGU;AACX,YAAG,KAAK3C,QAAR,EAAkB,OAAO,KAAKA,QAAL,GAAgB,KAAvB;AAClB,YAAIoD,YAAY,KAAKV,SAAL,CAAeW,GAAf,CAAmB,KAAKb,WAAxB,CAAhB;AACA,YAAIc,YAAYF,UAAUG,GAAV,EAAhB;AACA,YAAID,YAAYtE,UAAhB,EAA4B;AACxB,gBAAIwE,KAAKC,GAAL,CAASL,UAAUtC,CAAnB,IAAwB0C,KAAKC,GAAL,CAASL,UAAUxC,CAAnB,CAA5B,EAAmD;AAC/C,oBAAIwC,UAAUtC,CAAV,GAAc,CAAlB,EAAqB,KAAK4C,UAAL,CAAgBjF,UAAUG,KAA1B,EAArB,KACK,KAAK8E,UAAL,CAAgBjF,UAAUI,IAA1B;AACR,aAHD,MAGO;AACH,oBAAIuE,UAAUxC,CAAV,GAAc,CAAlB,EAAqB,KAAK8C,UAAL,CAAgBjF,UAAUK,EAA1B,EAArB,KACK,KAAK4E,UAAL,CAAgBjF,UAAUM,IAA1B;AACR;AACJ;AACJ,KAnHI;AAqHLoE,gBArHK,0BAqHU;AACX,YAAG,KAAKnD,QAAR,EAAkB,OAAO,KAAKA,QAAL,GAAgB,KAAvB;AAClB,YAAIoD,YAAY,KAAKV,SAAL,CAAeW,GAAf,CAAmB,KAAKb,WAAxB,CAAhB;AACA,YAAIc,YAAYF,UAAUG,GAAV,EAAhB;AACA,YAAID,YAAYtE,UAAhB,EAA4B;AACxB,gBAAIwE,KAAKC,GAAL,CAASL,UAAUtC,CAAnB,IAAwB0C,KAAKC,GAAL,CAASL,UAAUxC,CAAnB,CAA5B,EAAmD;AAC/C,oBAAIwC,UAAUtC,CAAV,GAAc,CAAlB,EAAqB,KAAK6C,UAAL,CAAgBlF,UAAUG,KAA1B,EAArB,KACK,KAAK+E,UAAL,CAAgBlF,UAAUI,IAA1B;AACR,aAHD,MAGO;AACH,oBAAIuE,UAAUxC,CAAV,GAAc,CAAlB,EAAqB,KAAK+C,UAAL,CAAgBlF,UAAUK,EAA1B,EAArB,KACK,KAAK6E,UAAL,CAAgBlF,UAAUM,IAA1B;AACR;AACJ;AACJ,KAlII;AAoIL2E,cApIK,sBAoIME,SApIN,EAoIiB;AAClB,aAAK7D,SAAL,GAAiB,KAAjB;AACA,gBAAQ6D,SAAR;AACI,iBAAKnF,UAAUG,KAAf;AACA,iBAAKH,UAAUI,IAAf;AACI,qBAAKkD,cAAL,CAAoB6B,SAApB;AACA;AACJ,iBAAKnF,UAAUK,EAAf;AACA,iBAAKL,UAAUM,IAAf;AACI,qBAAKiD,WAAL,CAAiB4B,SAAjB;AACA;;AARR;AAWH,KAjJI;AAmJLD,cAnJK,sBAmJMC,SAnJN,EAmJiB;AAClB,aAAK7D,SAAL,GAAiB,KAAjB;AACA,gBAAQ6D,SAAR;AACI,iBAAKnF,UAAUG,KAAf;AACA,iBAAKH,UAAUI,IAAf;AACI,qBAAKkD,cAAL,CAAoB6B,SAApB;AACA;AACJ,iBAAKnF,UAAUK,EAAf;AACA,iBAAKL,UAAUM,IAAf;AACI,qBAAKiD,WAAL,CAAiB4B,SAAjB;AACA;;AARR;AAWH,KAhKI;AAkKLC,iBAlKK,yBAkKSC,KAlKT,EAkKgB;AACjB,YAAIC,WAAW,EAAf;AACA,aAAI,IAAI/C,MAAM,CAAd,EAAiBA,MAAM5C,YAAYC,GAAnC,EAAwC2C,KAAxC,EAA+C;AAC3C,gBAAG8C,MAAM9C,GAAN,KAAc,CAAjB,EAAoB+C,SAASC,IAAT,CAAcF,MAAM9C,GAAN,CAAd;AACvB;AACD,aAAI,IAAIC,MAAM8C,SAASE,MAAvB,EAA+BhD,MAAM7C,YAAYE,GAAjD,EAAsD2C,KAAtD,EAA4D;AACxD8C,qBAASC,IAAT,CAAc,CAAd;AACH;AACD,eAAOD,QAAP;AACH,KA3KI;AA6KLG,oBA7KK,4BA6KYJ,KA7KZ,EA6KmB;;AAEpB,YAAIC,WAAW,EAAf;AACA,aAAI,IAAI/C,MAAM,CAAd,EAAiBA,MAAM5C,YAAYC,GAAnC,EAAwC2C,KAAxC,EAA+C;AAC3C,gBAAG8C,MAAM9C,GAAN,KAAc,CAAjB,EAAoB+C,SAASC,IAAT,CAAcF,MAAM9C,GAAN,CAAd;AACvB;AACD,aAAI,IAAIA,OAAM,CAAd,EAAiBA,OAAM5C,YAAYC,GAAnC,EAAwC2C,MAAxC,EAA+C;AAC3C,gBAAG8C,MAAM9C,IAAN,KAAc,CAAjB,EAAoB+C,SAASC,IAAT,CAAcF,MAAM9C,IAAN,CAAd;AACvB;AACD,eAAO+C,QAAP;AACH,KAvLI;AAyLLtD,UAzLK,oBAyLI;AACL,aAAK0D,WAAL;AACA,YAAIC,SAAS,EAAb;AACA,aAAI,IAAIpD,MAAM,CAAd,EAAiBA,MAAM5C,YAAYC,GAAnC,EAAwC2C,KAAxC,EAA+C;AAC3C,iBAAI,IAAIC,MAAM,CAAd,EAAiBA,MAAM7C,YAAYE,GAAnC,EAAwC2C,KAAxC,EAA+C;AAC3C,oBAAGzC,UAAUwC,GAAV,EAAeC,GAAf,KAAuB,CAA1B,EAA6B;AACzBmD,2BAAOJ,IAAP,CAAY,EAAClD,GAAGE,GAAJ,EAASJ,GAAGK,GAAZ,EAAZ;AACH;AACJ;AACJ;AACD,YAAGmD,OAAOH,MAAP,GAAgB,CAAnB,EAAsB;AAClB,gBAAII,WAAWD,OAAOZ,KAAKc,MAAL,KAAgBF,OAAOH,MAAvB,IAAiC,CAAxC,CAAf;AACA,gBAAIM,SAASf,KAAKgB,KAAL,CAAWhB,KAAKc,MAAL,KAAgB,CAA3B,CAAb;AACAC,qBAAS,CAAT,GAAa/F,UAAU6F,SAASvD,CAAnB,EAAsBuD,SAASzD,CAA/B,IAAoC,CAAjD,GAAqDpC,UAAU6F,SAASvD,CAAnB,EAAsBuD,SAASzD,CAA/B,IAAoC,CAAzF;AACH;AACD,aAAKF,SAAL;AACH,KAzMI;AA2ML+D,kBA3MK,0BA2MUC,IA3MV,EA2MgBC,IA3MhB,EA2MsB;AACvB,aAAI,IAAI3D,MAAM,CAAd,EAAiBA,MAAM5C,YAAYC,GAAnC,EAAwC2C,KAAxC,EAA+C;AAC3C,gBAAG0D,KAAK1D,GAAL,KAAa2D,KAAK3D,GAAL,CAAhB,EAA2B;AACvB,qBAAKjB,SAAL,GAAiB,IAAjB;AACH;AACJ;AACJ,KAjNI;AAmNL6E,aAnNK,uBAmNO;AACR,aAAK,IAAI5D,MAAM,CAAf,EAAkBA,MAAM5C,YAAYC,GAApC,EAAyC2C,KAAzC,EAAgD;AAC5C,iBAAK,IAAIC,MAAM,CAAf,EAAkBA,MAAM7C,YAAYE,GAApC,EAAyC2C,KAAzC,EAAgD;AAC5C,oBAAI1B,QAAQf,UAAUwC,GAAV,EAAeC,GAAf,CAAZ;AACA,oBAAI1B,UAAU,CAAd,EAAiB,OAAO,KAAP;AACjB,oBAAI0B,MAAM,CAAN,IAAWzC,UAAUwC,GAAV,EAAeC,MAAM,CAArB,KAA2B1B,KAA1C,EAAiD,OAAO,KAAP;AACjD,oBAAI0B,MAAM7C,YAAYC,GAAZ,GAAkB,CAAxB,IAA6BG,UAAUwC,GAAV,EAAeC,MAAM,CAArB,KAA2B1B,KAA5D,EAAmE,OAAO,KAAP;AACnE,oBAAIyB,MAAM,CAAN,IAAWxC,UAAUwC,MAAM,CAAhB,EAAmBC,GAAnB,KAA2B1B,KAA1C,EAAiD,OAAO,KAAP;AACjD,oBAAIyB,MAAM5C,YAAYC,GAAZ,GAAkB,CAAxB,IAA6BG,UAAUwC,MAAM,CAAhB,EAAmBC,GAAnB,KAA2B1B,KAA5D,EAAmE,OAAO,KAAP;AACtE;AACJ;AACD,eAAO,IAAP;AACH,KA/NI;AAiOLsF,YAjOK,sBAiOM;AACP,aAAI,IAAI7D,MAAM,CAAd,EAAiBA,MAAM5C,YAAYC,GAAnC,EAAwC2C,KAAxC,EAA+C;AAC3C,iBAAI,IAAIC,MAAK,CAAb,EAAgBA,MAAM7C,YAAYE,GAAlC,EAAuC2C,KAAvC,EAA8C;AAC1C,oBAAGzC,UAAUwC,GAAV,EAAeC,GAAf,MAAwB,IAA3B,EAAiC;AAC7B,yBAAKrB,OAAL,CAAaY,MAAb,GAAsB,IAAtB;AACH;AACJ;AACJ;AACJ,KAzOI;AA2OL2D,eA3OK,yBA2OS;AACV,YAAIW,OAAO,KAAK7E,MAAL,GAAc,KAAKC,UAA9B;AACA,aAAKT,KAAL,CAAWc,MAAX,GAAoB,KAAKN,MAAzB;AACA,aAAK8E,UAAL,CAAgBD,IAAhB;AACA,aAAKE,UAAL;AACH,KAhPI;AAkPLD,cAlPK,sBAkPME,GAlPN,EAkPW;AACZ,YAAIA,MAAM,CAAV,EAAa;AACT,gBAAIF,aAAarG,GAAGyC,WAAH,CAAe,KAAKrB,gBAApB,CAAjB;AACAiF,uBAAWG,MAAX,GAAoB,KAAKzF,KAAL,CAAW0F,IAA/B;AACAJ,uBAAWtD,YAAX,CAAwB/C,GAAGgB,KAA3B,EAAkCa,MAAlC,GAA2C,OAAO0E,GAAlD;AACAvG,eAAG0G,KAAH,CAASL,UAAT,EACKM,EADL,CACQ,GADR,EACa,EAAEC,UAAU5G,GAAG4C,EAAH,CAAM,EAAN,EAAU,EAAV,CAAZ,EADb,EAEKiE,IAFL,CAEU,YAAM;AACRR,2BAAWS,OAAX;AACH,aAJL,EAKKC,KALL;AAMH;AACJ,KA9PI;AAgQLC,gBAhQK,0BAgQU;AACX,aAAK1F,QAAL,GAAgB,IAAhB;AACA,aAAKC,MAAL,GAAc,CAAd;AACAzB,oBAAY,CAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAD,EAAY,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAZ,EACC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CADD,EACY,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CADZ,CAAZ;AAEA,aAAK4B,OAAL;AACH,KAtQI;AAwQL2B,kBAxQK,0BAwQU4D,KAxQV,EAwQiB;AAClB,aAAKzF,UAAL,GAAkB,KAAKD,MAAvB;AACA,aAAI,IAAIe,MAAM,CAAd,EAAiBA,MAAM5C,YAAYC,GAAnC,EAAwC2C,KAAxC,EAA+C;AAC3C,gBAAI4E,MAAMpH,UAAUwC,GAAV,CAAV;AACA,gBAAG2E,UAAU,EAAV,IAAgBA,UAAU,CAA7B,EAAgC;AAC5BnH,0BAAUwC,GAAV,IAAiB,KAAK6C,aAAL,CAAmBrF,UAAUwC,GAAV,CAAnB,CAAjB;AACA,qBAAI,IAAIC,MAAM,CAAd,EAAiBA,MAAM7C,YAAYE,GAAZ,GAAkB,CAAzC,EAA4C2C,KAA5C,EAAmD;AAC/C,wBAAGzC,UAAUwC,GAAV,EAAeC,GAAf,KAAuBzC,UAAUwC,GAAV,EAAeC,MAAM,CAArB,CAA1B,EAAmD;AAC/CzC,kCAAUwC,GAAV,EAAeC,GAAf,KAAuBzC,UAAUwC,GAAV,EAAeC,MAAM,CAArB,CAAvB;AACAzC,kCAAUwC,GAAV,EAAeC,MAAM,CAArB,IAA0B,CAA1B;AACA,6BAAKhB,MAAL,IAAezB,UAAUwC,GAAV,EAAeC,GAAf,CAAf;AACH;AACJ;AACDzC,0BAAUwC,GAAV,IAAiB,KAAK6C,aAAL,CAAmBrF,UAAUwC,GAAV,CAAnB,CAAjB;AACH;AACD,gBAAG2E,UAAU,EAAV,IAAgBA,UAAU,CAA7B,EAAgC;AAC5BnH,0BAAUwC,GAAV,IAAiB,KAAKkD,gBAAL,CAAsB1F,UAAUwC,GAAV,CAAtB,CAAjB;AACA,qBAAI,IAAIC,OAAM,CAAd,EAAiBA,OAAM,CAAvB,EAA0BA,MAA1B,EAAiC;AAC7B,wBAAGzC,UAAUwC,GAAV,EAAeC,IAAf,KAAuBzC,UAAUwC,GAAV,EAAeC,OAAM,CAArB,CAA1B,EAAmD;AAC/CzC,kCAAUwC,GAAV,EAAeC,IAAf,KAAuBzC,UAAUwC,GAAV,EAAeC,OAAM,CAArB,CAAvB;AACAzC,kCAAUwC,GAAV,EAAeC,OAAM,CAArB,IAA0B,CAA1B;AACA,6BAAKhB,MAAL,IAAezB,UAAUwC,GAAV,EAAeC,IAAf,CAAf;AACH;AACJ;AACDzC,0BAAUwC,GAAV,IAAiB,KAAKkD,gBAAL,CAAsB1F,UAAUwC,GAAV,CAAtB,CAAjB;AACH;AACD,iBAAKyD,cAAL,CAAoBmB,GAApB,EAAyBpH,UAAUwC,GAAV,CAAzB;AACH;AACD,YAAG,KAAKjB,SAAR,EAAmB;AACf,iBAAKU,MAAL;AACH;AACJ,KAvSI;AAySLuB,eAzSK,uBAySO2D,KAzSP,EAySc;AACf,aAAKzF,UAAL,GAAkB,KAAKD,MAAvB;AACA,aAAI,IAAIe,MAAM,CAAd,EAAiBA,MAAM5C,YAAYC,GAAnC,EAAwC2C,KAAxC,EAA+C;AAC3C,gBAAIoD,SAAS,EAAb;AACA,iBAAI,IAAInD,MAAM,CAAd,EAAiBA,MAAM7C,YAAYE,GAAnC,EAAwC2C,KAAxC,EAA+C;AAC3CmD,uBAAOJ,IAAP,CAAYxF,UAAUyC,GAAV,EAAeD,GAAf,CAAZ;AACH;AACD,gBAAI4E,MAAOxB,MAAX;AACA,gBAAGuB,UAAU,EAAV,IAAgBA,UAAU,CAA7B,EAAgC;AAC5BvB,yBAAS,KAAKP,aAAL,CAAmBO,MAAnB,CAAT;AACA,qBAAI,IAAIyB,IAAI,CAAZ,EAAeA,IAAI,CAAnB,EAAsBA,GAAtB,EAA2B;AACvB,wBAAGzB,OAAOyB,CAAP,KAAazB,OAAOyB,IAAI,CAAX,CAAhB,EAA+B;AAC3BzB,+BAAOyB,CAAP,KAAazB,OAAOyB,IAAI,CAAX,CAAb;AACAzB,+BAAOyB,IAAI,CAAX,IAAgB,CAAhB;AACA,6BAAK5F,MAAL,IAAemE,OAAOyB,CAAP,CAAf;AACH;AACJ;AACDzB,yBAAS,KAAKP,aAAL,CAAmBO,MAAnB,CAAT;AACH;AACD,gBAAGuB,UAAU,EAAV,IAAgBA,UAAU,CAA7B,EAAgC;AAC5BvB,yBAAS,KAAKF,gBAAL,CAAsBE,MAAtB,CAAT;AACA,qBAAI,IAAIyB,KAAI,CAAZ,EAAeA,KAAI,CAAnB,EAAsBA,IAAtB,EAA2B;AACvB,wBAAGzB,OAAOyB,EAAP,KAAazB,OAAOyB,KAAI,CAAX,CAAhB,EAA+B;AAC3BzB,+BAAOyB,EAAP,KAAazB,OAAOyB,KAAI,CAAX,CAAb;AACAzB,+BAAOyB,KAAI,CAAX,IAAgB,CAAhB;AACA,6BAAK5F,MAAL,IAAemE,OAAOyB,EAAP,CAAf;AACH;AACJ;AACDzB,yBAAS,KAAKF,gBAAL,CAAsBE,MAAtB,CAAT;AACH;AACD,iBAAI,IAAI0B,IAAI,CAAZ,EAAeA,IAAI,CAAnB,EAAsBA,GAAtB,EAA2B;AACvBtH,0BAAUsH,CAAV,EAAa9E,GAAb,IAAoBoD,OAAO0B,CAAP,CAApB;AACH;AACD,iBAAKrB,cAAL,CAAoBmB,GAApB,EAAyBxB,MAAzB;AACH;AACD,YAAG,KAAKrE,SAAR,EAAmB;AACf,iBAAKU,MAAL;AACH;AACJ,KA/UI;AAiVLH,kBAjVK,4BAiVY;AACb,YAAIyF,cAAcrH,GAAG4D,GAAH,CAAO0D,YAAP,CAAoBC,OAApB,CAA4B,WAA5B,CAAlB;AACA,YAAIF,gBAAgB,IAApB,EAA0B;AACtB,iBAAKpG,MAAL,CAAYY,MAAZ,GAAqB2F,KAAKC,KAAL,CAAWJ,WAAX,CAArB;AACH,SAFD,MAEO;AACH,iBAAKpG,MAAL,CAAYY,MAAZ,GAAqB,CAArB;AACH;AACJ,KAxVI;AA0VLyE,cA1VK,wBA0VQ;AACT,YAAIoB,WAAWC,SAAS,KAAK5G,KAAL,CAAWc,MAApB,CAAf;AACA,YAAI6F,WAAW,KAAKzG,MAAL,CAAYY,MAA3B,EAAmC;AAC/B7B,eAAG4D,GAAH,CAAO0D,YAAP,CAAoBM,OAApB,CAA4B,WAA5B,EAAyCJ,KAAKK,SAAL,CAAeH,QAAf,CAAzC;AACA,iBAAKzG,MAAL,CAAYY,MAAZ,GAAqB6F,QAArB;AACH;AACJ,KAhWI;AAkWLI,UAlWK,oBAkWI;AACL,aAAK3B,QAAL;AACA,YAAG,KAAKD,SAAL,EAAH,EAAqB;AACjB,iBAAK/E,QAAL,CAAcW,MAAd,GAAuB,IAAvB;AACA,iBAAKwE,UAAL;AACH;AACJ;AAxWI,CAAT","file":"GameManagaer.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["\nconst GAME_CONFIG = {\n    ROW: 4,\n    COL: 4,\n    MARGIN: 16 //results from: (this.mainGame.width - this.block.width * GAME_CONFIG.ROW) / 5;\n};\n\nlet ARR_BLOCK = [\n    [0, 0, 0, 0], [0, 0, 0, 0],\n    [0, 0, 0, 0], [0, 0, 0, 0],\n];\n\nconst DIRECTION = cc.Enum({\n    RIGHT: -1,\n    LEFT: -1,\n    UP: -1,\n    DOWN: -1\n});\n\nconst MIN_LENGTH = 10;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        mainGame: cc.Node,\n        block: cc.Prefab,\n        score: cc.Label,\n        record: cc.Label,\n        winGame: cc.Node,\n        loseGame: cc.Node,\n        hoverScorePrefab: cc.Prefab,\n\n        _isChange: false,\n        _restart: false,\n        _score: 0,\n        _tempScore : 0,\n    },\n\n    onLoad() {\n        // cc.sys.localStorage.removeItem('bestScore')\n        this.initObj();\n        this.eventHandler();\n        this.getScoreStorge();\n        this.score.string = 0; \n    },\n\n    initObj() {\n        this.loseGame.active = false;\n        this.winGame.active = false;\n        this.addNum();\n        this.addNum();\n    },\n\n    initBlock() {\n        this.mainGame.removeAllChildren();\n        let y = this.mainGame.height / 2 - GAME_CONFIG.MARGIN,\n            x = this.mainGame.width / -2 + GAME_CONFIG.MARGIN;\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            for(let col = 0; col < GAME_CONFIG.COL; col++) {\n                this.newBlock = cc.instantiate(this.block); \n                this.newBlock.setParent(this.mainGame);\n                this.newBlock.setPosition(cc.v2(x, y));\n                x += this.newBlock.width + GAME_CONFIG.MARGIN;\n                if(ARR_BLOCK[row][col] != 0) {\n                    let label = this.newBlock.getChildByName(\"Value\");\n                    label.getComponent(cc.Label).string = ARR_BLOCK[row][col];\n                    this.newBlock.getComponent(\"BlockController\").setColor();\n                }\n            }\n            y -= this.newBlock.height + GAME_CONFIG.MARGIN;\n            x = this.mainGame.width / -2 + GAME_CONFIG.MARGIN;\n        };\n    },\n\n    onKeyDown(event) {\n        if(this._isCLick){\n            this._isChange = false;\n            switch(event.keyCode) {\n                case 37:\n                case 39:\n                    this.checkLeftRight(event.keyCode);  \n                    break;\n                case 38: \n                case 40:\n                    this.checkUpDown(event.keyCode);\n            }\n        }\n    },\n\n    eventHandler() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        if (cc.sys.isMobile) {\n            this.mainGame.on(\"touchstart\", (event) => {\n                this._startPoint = event.getLocation();\n            })\n            this.mainGame.on(\"touchend\", (event) => {\n                this._endPoint = event.getLocation();\n                this.reflectTouch();\n            })\n            this.mainGame.on(\"touchcancel\", (event) => {\n                this._endPoint = event.getLocation();\n                this.reflectTouch();\n            })\n        }\n        if (cc.sys.IPAD || cc.sys.DESKTOP_BROWSER) {\n            this.mainGame.on(\"mousedown\", (event) => {\n                this._isCLick = false;\n                this._startPoint = event.getLocation();\n                this._firstX = this._startPoint.x;\n                this._firstY = this._startPoint.y;\n            })\n            this.mainGame.on(\"mouseup\", (event) => {\n                this._isCLick = true;\n                this._endPoint = event.getLocation();\n                this._endX = this._startPoint.x - this._endPoint.x;\n                this._endY = this._startPoint.y - this._endPoint.y;\n                this._vector = cc.v2(this._endX, this._endY);\n                this.reflectCLick();\n            })\n        }\n    },\n\n    reflectTouch() {\n        if(this._restart) return this._restart = false;\n        let pointsVec = this._endPoint.sub(this._startPoint);\n        let vecLength = pointsVec.mag();\n        if (vecLength > MIN_LENGTH) {\n            if (Math.abs(pointsVec.x) > Math.abs(pointsVec.y)) {\n                if (pointsVec.x > 0) this.touchEvent(DIRECTION.RIGHT);\n                else this.touchEvent(DIRECTION.LEFT);\n            } else {\n                if (pointsVec.y > 0) this.touchEvent(DIRECTION.UP);\n                else this.touchEvent(DIRECTION.DOWN);\n            }\n        }\n    },\n\n    reflectCLick() {\n        if(this._restart) return this._restart = false;\n        let pointsVec = this._endPoint.sub(this._startPoint);\n        let vecLength = pointsVec.mag();\n        if (vecLength > MIN_LENGTH) {\n            if (Math.abs(pointsVec.x) > Math.abs(pointsVec.y)) {\n                if (pointsVec.x > 0) this.mouseEvent(DIRECTION.RIGHT);\n                else this.mouseEvent(DIRECTION.LEFT);\n            } else {\n                if (pointsVec.y > 0) this.mouseEvent(DIRECTION.UP);\n                else this.mouseEvent(DIRECTION.DOWN);\n            }\n        }\n    },\n\n    touchEvent(direction) {\n        this._isChange = false;\n        switch (direction) {\n            case DIRECTION.RIGHT: \n            case DIRECTION.LEFT:\n                this.checkLeftRight(direction);\n                break;\n            case DIRECTION.UP: \n            case DIRECTION.DOWN: \n                this.checkUpDown(direction)\n                break;\n            \n        }\n    },\n \n    mouseEvent(direction) {\n        this._isChange = false;\n        switch (direction) {\n            case DIRECTION.RIGHT: \n            case DIRECTION.LEFT:\n                this.checkLeftRight(direction);\n                break;\n            case DIRECTION.UP: \n            case DIRECTION.DOWN: \n                this.checkUpDown(direction)\n                break;\n            \n        }\n    },\n\n    slideLeftOrUp(array) {\n        let newArray = [];\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            if(array[row] != 0) newArray.push(array[row]);\n        };\n        for(let col = newArray.length; col < GAME_CONFIG.COL; col++){\n            newArray.push(0);\n        }\n        return newArray;\n    },\n\n    slideRightOrDown(array) {\n        \n        let newArray = [];\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            if(array[row] == 0) newArray.push(array[row]);\n        };\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            if(array[row] != 0) newArray.push(array[row]);\n        };\n        return newArray;\n    },\n\n    addNum() {\n        this.updateScore();\n        let newArr = [];\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            for(let col = 0; col < GAME_CONFIG.COL; col++) { \n                if(ARR_BLOCK[row][col] == 0) {\n                    newArr.push({x: row, y: col});\n                }\n            }\n        }\n        if(newArr.length > 0) {\n            let randomXY = newArr[Math.random() * newArr.length >> 0];\n            let number = Math.floor(Math.random() * 4);\n            number < 3 ? ARR_BLOCK[randomXY.x][randomXY.y] = 2 : ARR_BLOCK[randomXY.x][randomXY.y] = 4;\n        }\n        this.initBlock();\n    },\n\n    hasChangeArray(arr1, arr2) {\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            if(arr1[row] != arr2[row]) {\n                this._isChange = true;\n            }\n        }\n    },\n\n    checkLose() {\n        for (let row = 0; row < GAME_CONFIG.ROW; row++) {\n            for (let col = 0; col < GAME_CONFIG.COL; col++) {\n                let block = ARR_BLOCK[row][col];\n                if (block === 0) return false;\n                if (col > 0 && ARR_BLOCK[row][col - 1] == block) return false;\n                if (col < GAME_CONFIG.ROW - 1 && ARR_BLOCK[row][col + 1] == block) return false;\n                if (row > 0 && ARR_BLOCK[row - 1][col] == block) return false;\n                if (row < GAME_CONFIG.ROW - 1 && ARR_BLOCK[row + 1][col] == block) return false;\n            }\n        }\n        return true;\n    }, \n\n    checkWin() {\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            for(let col =0; col < GAME_CONFIG.COL; col++) {\n                if(ARR_BLOCK[row][col] === 2048) {\n                    this.winGame.active = true;\n                }\n            }\n        }\n    },\n\n    updateScore() {\n        let temp = this._score - this._tempScore;\n        this.score.string = this._score;\n        this.hoverScore(temp)\n        this.checkScore();\n    },\n    \n    hoverScore(num) {\n        if (num > 0) {\n            let hoverScore = cc.instantiate(this.hoverScorePrefab);\n            hoverScore.parent = this.score.node;\n            hoverScore.getComponent(cc.Label).string = \"+ \" + num;\n            cc.tween(hoverScore)\n                .to(0.5, { position: cc.v2(50, 50) })\n                .call(() => {\n                    hoverScore.destroy()\n                })\n                .start()\n        }\n    },\n\n    clickRestart() {\n        this._restart = true;\n        this._score = 0;\n        ARR_BLOCK = [[0,0,0,0], [0,0,0,0],\n                     [0,0,0,0], [0,0,0,0]];\n        this.initObj();\n    },\n\n    checkLeftRight(value) {\n        this._tempScore = this._score;\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            let arr = ARR_BLOCK[row];\n            if(value === 37 || value === 1) {\n                ARR_BLOCK[row] = this.slideLeftOrUp(ARR_BLOCK[row]);\n                for(let col = 0; col < GAME_CONFIG.COL - 1; col++) {\n                    if(ARR_BLOCK[row][col] == ARR_BLOCK[row][col + 1]) {\n                        ARR_BLOCK[row][col] += ARR_BLOCK[row][col + 1];\n                        ARR_BLOCK[row][col + 1] = 0;\n                        this._score += ARR_BLOCK[row][col];\n                    }\n                }\n                ARR_BLOCK[row] = this.slideLeftOrUp(ARR_BLOCK[row]);\n            }\n            if(value === 39 || value === 0) {\n                ARR_BLOCK[row] = this.slideRightOrDown(ARR_BLOCK[row]);\n                for(let col = 3; col > 0; col--) {\n                    if(ARR_BLOCK[row][col] == ARR_BLOCK[row][col - 1]) {\n                        ARR_BLOCK[row][col] += ARR_BLOCK[row][col - 1];\n                        ARR_BLOCK[row][col - 1] = 0;\n                        this._score += ARR_BLOCK[row][col];\n                    }\n                }\n                ARR_BLOCK[row] = this.slideRightOrDown(ARR_BLOCK[row]);\n            }\n            this.hasChangeArray(arr, ARR_BLOCK[row]);\n        }\n        if(this._isChange) {\n            this.addNum();\n        }\n    },\n    \n    checkUpDown(value) {\n        this._tempScore = this._score;\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            let newArr = [];\n            for(let col = 0; col < GAME_CONFIG.COL; col++) {\n                newArr.push(ARR_BLOCK[col][row]);    \n            }\n            let arr  = newArr;\n            if(value === 38 || value === 2) {\n                newArr = this.slideLeftOrUp(newArr);\n                for(let m = 0; m < 3; m++) {\n                    if(newArr[m] == newArr[m + 1]) {\n                        newArr[m] += newArr[m + 1];\n                        newArr[m + 1] = 0;\n                        this._score += newArr[m];\n                    }\n                }\n                newArr = this.slideLeftOrUp(newArr);\n            }\n            if(value === 40 || value === 3) {\n                newArr = this.slideRightOrDown(newArr);\n                for(let m = 3; m > 0; m--) {\n                    if(newArr[m] == newArr[m - 1]) {\n                        newArr[m] += newArr[m - 1];\n                        newArr[m - 1] = 0;\n                        this._score += newArr[m];\n                    }\n                }\n                newArr = this.slideRightOrDown(newArr);\n            }\n            for(let i = 0; i < 4; i++) {\n                ARR_BLOCK[i][row] = newArr[i];\n            }\n            this.hasChangeArray(arr, newArr);\n        }\n        if(this._isChange) {\n            this.addNum();\n        }\n    },\n\n    getScoreStorge() {\n        let scoreStorge = cc.sys.localStorage.getItem('bestScore');\n        if (scoreStorge !== null) {\n            this.record.string = JSON.parse(scoreStorge);\n        } else {\n            this.record.string = 0;\n        }\n    },\n\n    checkScore() {\n        let newScore = parseInt(this.score.string);\n        if (newScore > this.record.string) {\n            cc.sys.localStorage.setItem('bestScore', JSON.stringify(newScore));\n            this.record.string = newScore;\n        }\n    },\n\n    update() {\n        this.checkWin();\n        if(this.checkLose()) {\n            this.loseGame.active = true;\n            this.checkScore();\n        };\n    },\n});\n"]}