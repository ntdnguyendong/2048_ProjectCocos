window.__require=function t(e,i,c){function o(s,n){if(!i[s]){if(!e[s]){var a=s.split("/");if(a=a[a.length-1],!e[a]){var h="function"==typeof __require&&__require;if(!n&&h)return h(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+s+"'")}}var f=i[s]={exports:{}};e[s][0].call(f.exports,function(t){return o(e[s][1][t]||t)},f,f.exports,t,e,i,c)}return i[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<c.length;s++)o(c[s]);return o}({BlockController:[function(t,e,i){"use strict";cc._RF.push(e,"e74a8E4HD5K97D/9d6IOq3s","BlockController");var c={0:cc.color("C0B4A4"),2:cc.color("E9DDD1"),4:cc.color("EAD9BE"),8:cc.color("F0E2A5"),16:cc.color("F28151"),32:cc.color("F26A4F"),64:cc.color("F2472E"),128:cc.color("E8C860"),256:cc.color("E9C34F"),512:cc.color("FF3300"),1024:cc.color("6666FF"),2048:cc.color("0033FF")};cc.Class({extends:cc.Component,properties:{Value:{default:null,type:cc.Label}},setColor:function(){var t=parseInt(this.Value.string);this.node.color=c[t]}}),cc._RF.pop()},{}],GameManagaer:[function(t,e,i){"use strict";cc._RF.push(e,"016acPX4gdMY7UAGkEsBhhU","GameManagaer");var c=4,o=4,r=16,s=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],n=cc.Enum({RIGHT:-1,LEFT:-1,UP:-1,DOWN:-1});cc.Class({extends:cc.Component,properties:{mainGame:cc.Node,block:cc.Prefab,score:cc.Label,record:cc.Label,winGame:cc.Node,loseGame:cc.Node,hoverScorePrefab:cc.Prefab,_isChange:!1,_restart:!1,_score:0,_tempScore:0},onLoad:function(){this.initObj(),this.eventHandler(),this.getScoreStorge(),this.score.string=0},initObj:function(){this.loseGame.active=!1,this.winGame.active=!1,this.addNum(),this.addNum()},initBlock:function(){this.mainGame.removeAllChildren();for(var t=this.mainGame.height/2-r,e=this.mainGame.width/-2+r,i=0;i<c;i++){for(var n=0;n<o;n++){if(this.newBlock=cc.instantiate(this.block),this.newBlock.setParent(this.mainGame),this.newBlock.setPosition(cc.v2(e,t)),e+=this.newBlock.width+r,0!=s[i][n])this.newBlock.getChildByName("Value").getComponent(cc.Label).string=s[i][n],this.newBlock.getComponent("BlockController").setColor()}t-=this.newBlock.height+r,e=this.mainGame.width/-2+r}},onKeyDown:function(t){if(this._isCLick)switch(this._isChange=!1,t.keyCode){case 37:case 39:this.checkLeftRight(t.keyCode);break;case 38:case 40:this.checkUpDown(t.keyCode)}},eventHandler:function(){var t=this;cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.sys.isMobile&&(this.mainGame.on("touchstart",function(e){t._startPoint=e.getLocation()}),this.mainGame.on("touchend",function(e){t._endPoint=e.getLocation(),t.reflectTouch()}),this.mainGame.on("touchcancel",function(e){t._endPoint=e.getLocation(),t.reflectTouch()})),(cc.sys.IPAD||cc.sys.DESKTOP_BROWSER)&&(this.mainGame.on("mousedown",function(e){t._isCLick=!1,t._startPoint=e.getLocation(),t._firstX=t._startPoint.x,t._firstY=t._startPoint.y}),this.mainGame.on("mouseup",function(e){t._isCLick=!0,t._endPoint=e.getLocation(),t._endX=t._startPoint.x-t._endPoint.x,t._endY=t._startPoint.y-t._endPoint.y,t._vector=cc.v2(t._endX,t._endY),t.reflectCLick()}))},reflectTouch:function(){if(this._restart)return this._restart=!1;var t=this._endPoint.sub(this._startPoint);t.mag()>10&&(Math.abs(t.x)>Math.abs(t.y)?t.x>0?this.touchEvent(n.RIGHT):this.touchEvent(n.LEFT):t.y>0?this.touchEvent(n.UP):this.touchEvent(n.DOWN))},reflectCLick:function(){if(this._restart)return this._restart=!1;var t=this._endPoint.sub(this._startPoint);t.mag()>10&&(Math.abs(t.x)>Math.abs(t.y)?t.x>0?this.mouseEvent(n.RIGHT):this.mouseEvent(n.LEFT):t.y>0?this.mouseEvent(n.UP):this.mouseEvent(n.DOWN))},touchEvent:function(t){switch(this._isChange=!1,t){case n.RIGHT:case n.LEFT:this.checkLeftRight(t);break;case n.UP:case n.DOWN:this.checkUpDown(t)}},mouseEvent:function(t){switch(this._isChange=!1,t){case n.RIGHT:case n.LEFT:this.checkLeftRight(t);break;case n.UP:case n.DOWN:this.checkUpDown(t)}},slideLeftOrUp:function(t){for(var e=[],i=0;i<c;i++)0!=t[i]&&e.push(t[i]);for(var r=e.length;r<o;r++)e.push(0);return e},slideRightOrDown:function(t){for(var e=[],i=0;i<c;i++)0==t[i]&&e.push(t[i]);for(var o=0;o<c;o++)0!=t[o]&&e.push(t[o]);return e},addNum:function(){this.updateScore();for(var t=[],e=0;e<c;e++)for(var i=0;i<o;i++)0==s[e][i]&&t.push({x:e,y:i});if(t.length>0){var r=t[Math.random()*t.length>>0],n=Math.floor(4*Math.random());s[r.x][r.y]=n<3?2:4}this.initBlock()},hasChangeArray:function(t,e){for(var i=0;i<c;i++)t[i]!=e[i]&&(this._isChange=!0)},checkLose:function(){for(var t=0;t<c;t++)for(var e=0;e<o;e++){var i=s[t][e];if(0===i)return!1;if(e>0&&s[t][e-1]==i)return!1;if(e<c-1&&s[t][e+1]==i)return!1;if(t>0&&s[t-1][e]==i)return!1;if(t<c-1&&s[t+1][e]==i)return!1}return!0},checkWin:function(){for(var t=0;t<c;t++)for(var e=0;e<o;e++)2048===s[t][e]&&(this.winGame.active=!0)},updateScore:function(){var t=this._score-this._tempScore;this.score.string=this._score,this.hoverScore(t),this.checkScore()},hoverScore:function(t){if(t>0){var e=cc.instantiate(this.hoverScorePrefab);e.parent=this.score.node,e.getComponent(cc.Label).string="+ "+t,cc.tween(e).to(.5,{position:cc.v2(50,50)}).call(function(){e.destroy()}).start()}},clickRestart:function(){this._restart=!0,this._score=0,s=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.initObj()},checkLeftRight:function(t){this._tempScore=this._score;for(var e=0;e<c;e++){var i=s[e];if(37===t||1===t){s[e]=this.slideLeftOrUp(s[e]);for(var r=0;r<o-1;r++)s[e][r]==s[e][r+1]&&(s[e][r]+=s[e][r+1],s[e][r+1]=0,this._score+=s[e][r]);s[e]=this.slideLeftOrUp(s[e])}if(39===t||0===t){s[e]=this.slideRightOrDown(s[e]);for(var n=3;n>0;n--)s[e][n]==s[e][n-1]&&(s[e][n]+=s[e][n-1],s[e][n-1]=0,this._score+=s[e][n]);s[e]=this.slideRightOrDown(s[e])}this.hasChangeArray(i,s[e])}this._isChange&&this.addNum()},checkUpDown:function(t){this._tempScore=this._score;for(var e=0;e<c;e++){for(var i=[],r=0;r<o;r++)i.push(s[r][e]);var n=i;if(38===t||2===t){i=this.slideLeftOrUp(i);for(var a=0;a<3;a++)i[a]==i[a+1]&&(i[a]+=i[a+1],i[a+1]=0,this._score+=i[a]);i=this.slideLeftOrUp(i)}if(40===t||3===t){i=this.slideRightOrDown(i);for(var h=3;h>0;h--)i[h]==i[h-1]&&(i[h]+=i[h-1],i[h-1]=0,this._score+=i[h]);i=this.slideRightOrDown(i)}for(var f=0;f<4;f++)s[f][e]=i[f];this.hasChangeArray(n,i)}this._isChange&&this.addNum()},getScoreStorge:function(){var t=cc.sys.localStorage.getItem("bestScore");this.record.string=null!==t?JSON.parse(t):0},checkScore:function(){var t=parseInt(this.score.string);t>this.record.string&&(cc.sys.localStorage.setItem("bestScore",JSON.stringify(t)),this.record.string=t)},update:function(){this.checkWin(),this.checkLose()&&(this.loseGame.active=!0,this.checkScore())}}),cc._RF.pop()},{}]},{},["BlockController","GameManagaer"]);